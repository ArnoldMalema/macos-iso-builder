name: Download, Split, and Reupload Artifact

on:
  workflow_dispatch:
    inputs:
      run_id:
        description: "Workflow run ID to pull artifact from"
        required: true
      artifact_name:
        description: "Artifact name to download"
        required: true
      part_size_mb:
        description: "Chunk size in MB (e.g. 1024)"
        required: false
        default: "1024"
      artifact_prefix:
        description: "Prefix for output chunk artifacts"
        required: true

jobs:
  download-split-upload:
    runs-on: ubuntu-latest

    steps:
      - name: Download artifact from another run
        uses: actions/download-artifact@v4
        with:
          run-id: ${{ github.event.inputs.run_id }}
          name: ${{ github.event.inputs.artifact_name }}
          path: downloaded

      - name: Confirm file downloaded
        run: |
          echo "Downloaded files:"
          ls -lh downloaded
          FILE=$(ls downloaded)
          echo "FILE_NAME=$FILE" >> $GITHUB_ENV

      - name: Split artifact into parts
        run: |
          mkdir parts
          split -b $(( ${{ github.event.inputs.part_size_mb }} * 1024 * 1024 )) \
            "downloaded/$FILE_NAME" \
            "parts/${{ github.event.inputs.artifact_prefix }}.part_"
          ls -lh parts

      - name: Upload chunked parts (one artifact)
        uses: actions/upload-artifact@v4
        with:
          name: ${{ github.event.inputs.artifact_prefix }}-parts
          path: parts/*
          retention-days: 7
